import type { NextPage } from 'next'
import Head from 'next/head'
import { AppTitle } from 'components/style'
import TotalSaldoComponent from 'components/TotalSaldoComponent'
import Box from '@mui/material/Box'
import TabKantong from 'components/TabKantong'
import BannerPengeluaran from 'components/BannerPengeluaran'
import { useEffect } from 'react'
import ACTIONS from 'store/registerActions'
import { useDispatch, useSelector } from 'react-redux'
import { db } from 'services/firebase-client'
import { collection, onSnapshot } from 'firebase/firestore'

const Home: NextPage = () => {
  const dispatch = useDispatch()
  const { summaryIncomes } = useSelector((state: any) => state.incomes)

  const kantongRef = collection(db, 'kantong')

  useEffect(() => {
    const unsubscribe = onSnapshot(kantongRef, (querySnapshot) => {
      dispatch(ACTIONS.incomes.getSummaryIncomes())
      console.log('listen')
    });
    // dispatch(ACTIONS.incomes.getSummaryIncomes())
  }, [])

  const listKantong = summaryIncomes.filter((item: any) => item.id !== 'total')
  const totalSaldo = summaryIncomes.find((item: any) => item.id === 'total')

  return (
    <Box pt="24px" pb="72px" px="12px" sx={{ minHeight: "100vh", position: 'relative' }}>
      <Head>
        <title>My Finance Application</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <AppTitle mb="62px">
        <h3>My Finance Application</h3>
      </AppTitle>

      <TotalSaldoComponent data={totalSaldo} />
      <TabKantong list={listKantong} />
      <BannerPengeluaran />
    </Box>
  )
}

export default Home
